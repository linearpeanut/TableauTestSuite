javascript:(function(){const R='tc:registry',P='tc:capture:',H='tc:hidden:',d=document,ls=localStorage,qs=d.querySelector.bind(d),qa=d.querySelectorAll.bind(d),ce=d.createElement.bind(d),gi=ls.getItem.bind(ls),si=ls.setItem.bind(ls),ri=ls.removeItem.bind(ls),jp=JSON.parse,js=JSON.stringify,u=()=>window.crypto?.randomUUID?.()||'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g,c=>{let r=Math.random()*16|0;return(c=='x'?r:(r&3|8)).toString(16)}),l=()=>{try{return jp(gi(R)||'[]')}catch{return[]}},sv=r=>si(R,js(r)),add=e=>{let i=u();si(P+i,js(e));let r=l();r.push({id:i,url:e.url,timestamp:e.timestamp,sheetCount:(e.data||[]).length,selected:!1});sv(r);return i},rm=i=>{ri(P+i);sv(l().filter(x=>x.id!==i))},get=i=>{try{return jp(gi(P+i)||'{}')}catch{return{}}},sel=(i,v)=>sv(l().map(x=>(x.id===i&&(x.selected=!!v),x))),getS=()=>l().filter(x=>x.selected).map(x=>x.id),out=m=>{let o=qs('#tcOutput');o&&(o.innerHTML=m)},gsd=sh=>sh.getSummaryDataAsync().then(dt=>({name:sh.getName(),columns:dt.getColumns().map(c=>c.getFieldName()),data:dt.getData().map(r=>r.map(v=>v.value))})),cap=()=>{let v=window.tableau?.VizManager?.getVizs?.()?.[0];if(!v)return Promise.reject(Error('No viz'));let as=v.getWorkbook().getActiveSheet();if(!as?.getWorksheets)return Promise.reject(Error('Not a dashboard'));return Promise.all(as.getWorksheets().map(gsd)).then(dt=>{add({data:dt,timestamp:new Date().toISOString(),url:location.href});out('Captured '+dt.length+' sheets')})},cs=a=>{let s=js(a),h=0,i=0,ln=s.length;for(;i<ln;i++)h=((h<<5)-h+s.charCodeAt(i))|0;return h},hk=(sh,c)=>{let k=sh+':'+c.type+':';if(c.type==='fa'||c.type==='fr')k+=c.fields.join(',');else if(c.type==='rr'||c.type==='ra')k+=c.index;else if(c.type==='rc')k+=c.index+':'+c.cells.map(x=>x.col).join(',');return k},gh=()=>{try{return jp(gi(H)||'{}')}catch{return{}}},hd=k=>{let hdn=gh();hdn[k]=!0;si(H,js(hdn))},uhd=k=>{let hdn=gh();delete hdn[k];si(H,js(hdn))},ih=k=>!!gh()[k],chh=()=>{si(H,js({}));out('Hidden changes cleared')},ix=r=>{let m=new Map;r.forEach((row,i)=>m.set(js(row),{idx:i,checksum:cs(row),row:row}));return m},ds=(p,c)=>{let df=[],pc=p.columns||[],cc=c.columns||[],ad=cc.filter(x=>!pc.includes(x)),rd=pc.filter(x=>!cc.includes(x)),pi=ix(p.data||[]),ci=ix(c.data||[]),ml=Math.max;ad.length&&df.push({type:'fa',fields:ad});rd.length&&df.push({type:'fr',fields:rd});pi.forEach((pv,k)=>{let cv=ci.get(k);if(!cv)df.push({type:'rr',index:pv.idx,row:pv.row,cols:pc});else if(pv.checksum!==cv.checksum){let ch=[],j=0,mc=ml(pc.length,cc.length);for(;j<mc;j++)pv.row[j]!==cv.row[j]&&ch.push({col:pc[j]||cc[j]||'col'+j,from:pv.row[j],to:cv.row[j]});ch.length&&df.push({type:'rc',index:cv.idx,cells:ch})}});ci.forEach((cv,k)=>pi.has(k)||df.push({type:'ra',index:cv.idx,row:cv.row,cols:cc}));let rr=df.filter(x=>x.type==='rr'),ra=df.filter(x=>x.type==='ra');for(let r of rr){let a=ra.find(x=>x.index===r.index);if(a){let ch=[],mc=ml(r.row.length,a.row.length);for(let j=0;j<mc;j++){let col=(r.cols||[])[j]||(a.cols||[])[j]||'col'+j;if(r.row[j]!==a.row[j])ch.push({col:col,from:r.row[j],to:a.row[j]})}if(ch.length){df=df.filter(x=>x!==r&&x!==a);df.push({type:'rc',index:r.index,cells:ch})}}}return df},dd=(p,c)=>{let A=[...(p.data||[])].sort((a,b)=>a.name.localeCompare(b.name)),B=[...(c.data||[])].sort((a,b)=>a.name.localeCompare(b.name)),o=[];for(let ps of A){let cs=B.find(x=>x.name===ps.name);if(cs){let ch=ds(ps,cs);ch.length&&o.push({sheet:ps.name,changes:ch})}}return o},fmt=v=>v===null?'null':v===undefined?'undefined':typeof v==='string'?v:js(v),fr=(r,c)=>r.map((v,i)=>'<b>'+(c[i]||'col'+i)+':</b> '+fmt(v)).join(', '),rd=df=>{if(!df.length){out('No differences');return}let h='<div style=\"font-family:monospace\">',fldCnt=0,rowCnt=0,chgCnt=0,hidCnt=0;for(let i of df){let sh=i.changes;h+='<div style=\"margin:12px 0;padding:8px;background:#f8f9fa;border-left:4px solid #4a67d6\"><div style=\"font-weight:bold;margin-bottom:8px;font-size:13px\">'+i.sheet+'</div>';for(let c of sh){let k=hk(i.sheet,c);if(ih(k)){hidCnt++;continue}let hcb='<label style=\"float:right;font-size:9px;color:#999;cursor:pointer;user-select:none\"><input type=\"checkbox\" class=\"tc-hide\" data-key=\"'+k+'\" style=\"margin-right:3px\">Hide</label>';if(c.type==='fa'){h+='<div style=\"margin:4px 0;padding:4px 8px;background:#d1f4d1;border-left:3px solid #4caf50;position:relative\">'+hcb+'+ FIELDS: '+c.fields.join(', ')+'</div>';fldCnt++}else if(c.type==='fr'){h+='<div style=\"margin:4px 0;padding:4px 8px;background:#ffd1d1;border-left:3px solid #f44336;position:relative\">'+hcb+'- FIELDS: '+c.fields.join(', ')+'</div>';fldCnt++}else if(c.type==='rr'){h+='<div style=\"margin:4px 0;padding:6px 8px;background:#fff0f0;border-left:3px solid #e57373;position:relative\">'+hcb+'<div style=\"color:#c62828;font-weight:bold\">&minus; ROW '+c.index+'</div>';let cols=c.cols||[];for(let j=0;j<c.row.length;j++)h+='<div style=\"margin-left:12px;font-size:10px;color:#666\">'+cols[j]+': '+fmt(c.row[j])+'</div>';h+='</div>';rowCnt++}else if(c.type==='ra'){h+='<div style=\"margin:4px 0;padding:6px 8px;background:#f0fff0;border-left:3px solid #81c784;position:relative\">'+hcb+'<div style=\"color:#2e7d32;font-weight:bold\">+ ROW '+c.index+'</div>';let cols=c.cols||[];for(let j=0;j<c.row.length;j++)h+='<div style=\"margin-left:12px;font-size:10px;color:#666\">'+cols[j]+': '+fmt(c.row[j])+'</div>';h+='</div>';rowCnt++}else if(c.type==='rc'){h+='<div style=\"margin:4px 0;padding:6px 8px;background:#e8f4f8;border-left:3px solid #42a5f5;position:relative\">'+hcb+'<div style=\"color:#1565c0;font-weight:bold;margin-bottom:4px\">&#9889; ROW '+c.index+' ('+c.cells.length+' changes)</div>';for(let cc of c.cells)h+='<div style=\"margin-left:12px;margin:2px 0\"><div style=\"font-size:10px;color:#555;font-weight:bold\">'+cc.col+'</div><div style=\"margin-left:8px;font-size:10px\"><span style=\"color:#c62828\">&minus; '+fmt(cc.from)+'</span></div><div style=\"margin-left:8px;font-size:10px\"><span style=\"color:#2e7d32\">+ '+fmt(cc.to)+'</span></div></div>';h+='</div>';chgCnt++}}h+='</div>'}h+='</div><div style=\"margin-top:12px;padding:8px;background:#fff3cd;border-left:4px solid #ffc107;font-size:11px\"><b>Summary:</b> '+fldCnt+' field changes, '+rowCnt+' rows added/removed, '+chgCnt+' rows modified'+(hidCnt?' ('+hidCnt+' hidden)':'')+'<button id=\"tcShowHidden\" style=\"margin-left:8px;padding:2px 6px;font-size:10px;background:#666;color:#fff;border:0;border-radius:2px;cursor:pointer\">Manage Hidden</button></div>';out(h);qa('.tc-hide').forEach(cb=>cb.addEventListener('change',function(){if(this.checked){hd(this.dataset.key);cmp()}}));qs('#tcShowHidden')?.addEventListener('click',shh)},cmp=()=>{let i=getS();if(i.length!==2){out('Select exactly 2');return}let A=get(i[0]),B=get(i[1]);(!A.data||!B.data)?out('Missing data'):rd(dd(A,B))},shh=()=>{let hdn=gh(),ks=Object.keys(hdn);if(!ks.length){out('No hidden changes');return}let h='<div style=\"font-family:monospace\"><div style=\"margin-bottom:8px;font-weight:bold\">Hidden Changes:</div>';for(let k of ks){let ps=k.split(':');h+='<div style=\"margin:4px 0;padding:4px 8px;background:#f5f5f5;border-radius:3px;font-size:10px\"><label style=\"display:flex;gap:6px;align-items:center\"><input type=\"checkbox\" class=\"tc-unhide\" data-key=\"'+k+'\"><span>'+ps[0]+' - '+ps[1]+'</span></label></div>'}h+='</div><div style=\"margin-top:8px;display:flex;gap:6px\"><button id=\"tcClearHidden\" style=\"flex:1;padding:6px;font-size:11px;background:#c64b4b;color:#fff;border:0;border-radius:3px;cursor:pointer\">Clear All Hidden</button><button id=\"tcBackToCompare\" style=\"padding:6px;font-size:11px;background:#4a67d6;color:#fff;border:0;border-radius:3px;cursor:pointer\">Back</button></div>';out(h);qa('.tc-unhide').forEach(cb=>cb.addEventListener('change',function(){if(this.checked){uhd(this.dataset.key);shh()}}));qs('#tcClearHidden')?.addEventListener('click',()=>{chh();shh()});qs('#tcBackToCompare')?.addEventListener('click',cmp)},su=u=>{try{return u.split('/').pop()||'Unknown'}catch{return'Unknown'}},lst=()=>{let r=l(),h='<div>',di='data-id';for(let i of r){let t=(i.timestamp||'').replace('T',' ').replace('Z','');h+='<div style=\"margin:8px 0;padding:6px;background:#f5f5f5;border-radius:3px\"><label style=\"display:flex;gap:6px\"><input type=\"checkbox\" class=\"tc-sel\" '+di+'=\"'+i.id+'\" '+(i.selected?'checked':'')+'><span style=\"font-size:11px\">'+su(i.url)+'</span></label><small style=\"color:#666\">Sheets: '+(i.sheetCount||0)+' | '+t+'</small><button class=\"tc-clear-one\" '+di+'=\"'+i.id+'\" style=\"margin-top:4px;padding:3px 6px;font-size:10px;background:#c64b4b;color:#fff;border:0;border-radius:2px;cursor:pointer\">Clear</button></div>'}h+='</div><div style=\"margin-top:6px;display:flex;gap:6px\"><button id=\"tcCompareSel\" style=\"flex:1;padding:6px;font-size:11px;background:#4a67d6;color:#fff;border:0;border-radius:3px;cursor:pointer\">Compare Selected</button><button id=\"tcClearAll\" style=\"padding:6px;font-size:11px;background:#777;color:#fff;border:0;border-radius:3px;cursor:pointer\">Clear All</button></div>';out(h);qa('.tc-sel').forEach(c=>c.addEventListener('change',function(){sel(this.dataset.id,this.checked)}));qa('.tc-clear-one').forEach(b=>b.addEventListener('click',function(){rm(this.dataset.id);lst()}));qs('#tcClearAll')?.addEventListener('click',()=>{l().forEach(i=>ri(P+i.id));sv([]);out('Cleared')});qs('#tcCompareSel')?.addEventListener('click',cmp)},addTest=(cat,status,label,details,rec='')=>{testSuite.results.push({category:cat,status,label,details,recommendation:rec,timestamp:Date.now()-testSuite.startTime});testSuite[status==='pass'?'passed':status==='fail'?'failed':status==='warn'?'warnings':'info']++},updateProgress=pct=>{let pb=qs('#tts-progress-bar');pb&&(pb.style.width=pct+'%')},testDeploymentIntegrity=async()=>{let dashboards=qa('[data-tb-test-id*=\"dashboard\"],.tableau-dashboard,.tab-dashboard');addTest('deployment',dashboards.length>0?'pass':'fail','Component Dashboards Detected',dashboards.length+' dashboard component(s) found',dashboards.length===0?'Verify Tableau dashboard is fully loaded':'');let containers=qa('.tabContainerFrame,iframe[src*=\"tableau\"]');addTest('deployment',containers.length>0?'info':'warn','Container HTML Detection',containers.length+' container(s) detected',containers.length===0?'Check if using embedded container HTML':'');let testFlags=Array.from(qa('*')).filter(el=>el.textContent.toLowerCase().includes('test')||el.className.toLowerCase().includes('test'));addTest('deployment',testFlags.length<5?'pass':'warn','Test Flag Check',testFlags.length+' potential test flag(s) found',testFlags.length>=5?'Review for test flags in titles/classes':'')},testVersionControl=async()=>{let versionElements=Array.from(qa('*')).filter(el=>/v?\\d+\\.\\d+(\\.\\d+)?/i.test(el.textContent));let versions=new Set(versionElements.map(el=>el.textContent.match(/v?\\d+\\.\\d+(\\.\\d+)?/i)?.[0]));addTest('version',versions.size<=1?'pass':'warn','Version Consistency',versions.size<=1?'Single version detected':'Multiple versions found: '+Array.from(versions).join(', '),versions.size>1?'Ensure all components have same version number':'');let testLabels=qa('[title*=\"test\" i],[aria-label*=\"test\" i]');addTest('version',testLabels.length===0?'pass':'warn','Test Labels in Production',testLabels.length===0?'No test labels found':testLabels.length+' test label(s) detected',testLabels.length>0?'Remove test flags from production':'')},testVisualDesign=async()=>{let allElements=qa('*');let fonts=new Set(),fontSizes=new Set();allElements.forEach(el=>{let style=window.getComputedStyle(el);fonts.add(style.fontFamily);fontSizes.add(style.fontSize)});addTest('visual',fonts.size<=5?'pass':'warn','Font Consistency',fonts.size+' unique font families',fonts.size>5?'Consider consolidating to brand fonts':'');let margins=[],paddings=[];qa('.tab-widget,.tableau-viz').forEach(el=>{let style=window.getComputedStyle(el);margins.push(parseInt(style.marginTop)||0);paddings.push(parseInt(style.paddingTop)||0)});let marginVariance=margins.length>0?Math.max(...margins)-Math.min(...margins):0;addTest('visual',marginVariance<=8?'pass':'warn','Margin Alignment','Max variance: '+marginVariance+'px',marginVariance>8?'Check vertical alignment consistency':'');let colors=new Set();qa('[fill],[stroke],[style*=\"color\"],[style*=\"background\"]').forEach(el=>{let fill=el.getAttribute('fill'),stroke=el.getAttribute('stroke'),style=window.getComputedStyle(el);if(fill&&fill!=='none')colors.add(fill);if(stroke&&stroke!=='none')colors.add(stroke);colors.add(style.color);colors.add(style.backgroundColor)});addTest('visual',colors.size<50?'pass':'info','Color Palette',colors.size+' unique colors detected','Review against brand guidelines');let tooltips=qa('[data-tb-test-id*=\"tooltip\"],.tableau-tooltip');let enabledTooltips=Array.from(tooltips).filter(tt=>!tt.hasAttribute('disabled')&&window.getComputedStyle(tt).display!=='none');addTest('visual',enabledTooltips.length<tooltips.length*0.3?'pass':'warn','Tooltip Usage',enabledTooltips.length+'/'+tooltips.length+' tooltips enabled',enabledTooltips.length>tooltips.length*0.5?'Consider disabling redundant tooltips':'');let headings=qa('h1,h2,h3,h4,h5,h6,[role=\"heading\"]');addTest('visual',headings.length>0?'pass':'warn','Typography Hierarchy',headings.length+' heading(s) found',headings.length===0?'Add proper heading structure':'');let allText=Array.from(qa('*')).map(el=>el.textContent).join(' ');let typos=['teh ','recieve','occured','thier','seperate'];let foundTypos=typos.filter(t=>allText.toLowerCase().includes(t));addTest('visual',foundTypos.length===0?'pass':'warn','Spelling Check',foundTypos.length===0?'No common typos found':'Potential typos: '+foundTypos.join(', '),foundTypos.length>0?'Run spell check on all text':'');let thumbnails=qa('[data-tb-test-id*=\"thumbnail\"],img[src*=\"thumb\"]');addTest('visual',thumbnails.length>0?'info':'warn','Dashboard Thumbnails',thumbnails.length+' thumbnail(s) found',thumbnails.length===0?'Verify thumbnails are updated':'')},testDataValidation=async()=>{let tables=qa('table,[role=\"table\"],.tabular-data');addTest('data',tables.length>0?'pass':'info','Data Tables Detected',tables.length+' table(s) found');let cells=qa('td,[role=\"cell\"]');let nullCells=Array.from(cells).filter(c=>{let t=c.textContent.trim().toLowerCase();return t==='null'||t==='n/a'||t===''||t==='#n/a'||t==='nan'});addTest('data',nullCells.length<cells.length*0.05?'pass':'warn','Null Value Handling',nullCells.length+'/'+cells.length+' cells with null/empty values',nullCells.length>cells.length*0.05?'Review null handling logic':'');let errorIndicators=qa('.error,.alert,[class*=\"error\"],[data-tb-test-id*=\"error\"],.tab-error');addTest('data',errorIndicators.length===0?'pass':'fail','Error Indicators',errorIndicators.length===0?'No errors detected':errorIndicators.length+' error(s) found',errorIndicators.length>0?'Investigate and resolve errors':'');let hashErrors=Array.from(cells).filter(c=>c.textContent.includes('#####'));addTest('data',hashErrors.length===0?'pass':'fail','Column Width Issues',hashErrors.length===0?'No ##### errors':'Found '+hashErrors.length+' ##### error(s)',hashErrors.length>0?'Increase column widths':'');let filters=qa('[data-tb-test-id*=\"filter\"],.tab-filter,.filter-container,select[name*=\"filter\"]');addTest('data',filters.length>0?'pass':'info','Filter Controls',filters.length+' filter(s) detected');let duplicateFilters=qa('.tab-filter');let filterTexts=Array.from(duplicateFilters).map(f=>f.textContent);let hasDupes=filterTexts.length!==new Set(filterTexts).size;addTest('data',!hasDupes?'pass':'warn','Duplicate Filters',hasDupes?'Duplicate filters detected':'No duplicate filters',hasDupes?'Remove duplicate filters on worksheets':'');let params=qa('[data-tb-test-id*=\"parameter\"],input[name*=\"param\"],.parameter-control');addTest('data',params.length>0?'info':'info','Parameters',params.length+' parameter control(s)');let dateElements=Array.from(qa('*')).filter(el=>/\\d{1,2}[\\/\\-]\\d{1,2}[\\/\\-]\\d{2,4}/.test(el.textContent));addTest('data',dateElements.length>0?'info':'warn','Date Display',dateElements.length+' element(s) with date format',dateElements.length===0?'Verify date fields are displaying':'');let lastRefresh=Array.from(qa('*')).find(el=>el.textContent.toLowerCase().includes('last refresh')||el.textContent.toLowerCase().includes('as of')||el.textContent.toLowerCase().includes('updated'));addTest('data',lastRefresh?'pass':'warn','Data Refresh Indicator',lastRefresh?'Refresh indicator found':'No refresh indicator',!lastRefresh?'Add last refresh date/time to dashboard':'');let kpis=qa('[class*=\"kpi\"],[data-tb-test-id*=\"kpi\"],.metric-card');addTest('data',kpis.length>0?'info':'info','KPI Elements',kpis.length+' KPI element(s) detected')},testFunctionalTests=async()=>{let exportButtons=qa('[title*=\"download\" i],[aria-label*=\"download\" i],[title*=\"export\" i],[data-tb-test-id*=\"download\"]');addTest('functional',exportButtons.length>0?'pass':'warn','Export Functionality',exportButtons.length+' export button(s) found',exportButtons.length===0?'Verify export functionality is available':'');let printButtons=qa('[title*=\"print\" i],[onclick*=\"print\"]');addTest('functional',printButtons.length>0?'pass':'info','Print Functionality',printButtons.length+' print button(s) found');let saveViewButtons=qa('[title*=\"save\" i],[title*=\"custom view\" i]');addTest('functional',saveViewButtons.length>0?'pass':'info','Custom View Save',saveViewButtons.length+' save view button(s) found');let feedbackButtons=qa('[title*=\"feedback\" i],[aria-label*=\"feedback\" i]');addTest('functional',feedbackButtons.length>0?'pass':'info','Feedback Tools',feedbackButtons.length+' feedback button(s) found');let navButtons=qa('button,[role=\"button\"],a[href*=\"#\"],.nav-button');addTest('functional',navButtons.length>0?'pass':'info','Interactive Elements',navButtons.length+' interactive element(s)');let forms=qa('form');forms.forEach((form,i)=>{let requiredFields=form.querySelectorAll('[required]');addTest('functional','form-'+i,requiredFields.length>0?'pass':'info','Form '+i+' Required Fields',requiredFields.length+' required field(s)')});let hamburger=qa('[class*=\"hamburger\"],[class*=\"menu-icon\"]');addTest('functional',hamburger.length>0?'pass':'info','Navigation Menu',hamburger.length+' menu icon(s) found');let dropdowns=qa('select,.dropdown,select[multiple]');addTest('functional',dropdowns.length>0?'info':'info','Dropdown Controls',dropdowns.length+' dropdown(s) detected');let links=qa('a[href]');let brokenLinks=Array.from(links).filter(l=>l.href==='#'||l.href.endsWith('#'));addTest('functional',brokenLinks.length<links.length*0.1?'pass':'warn','Link Integrity',brokenLinks.length+'/'+links.length+' placeholder links',brokenLinks.length>links.length*0.1?'Update placeholder links':'')},testPerformance=async()=>{let timing=performance.timing;let loadTime=timing.loadEventEnd-timing.navigationStart;let domReady=timing.domContentLoadedEventEnd-timing.navigationStart;addTest('technical',loadTime<5000?'pass':'warn','Page Load Time',loadTime+'ms',loadTime>=5000?'Optimize for load time <5s':'');addTest('technical',domReady<3000?'pass':'warn','DOM Ready Time',domReady+'ms',domReady>=3000?'Optimize DOM construction':'');let images=qa('img');let brokenImages=Array.from(images).filter(img=>!img.complete||img.naturalHeight===0);addTest('technical',brokenImages.length===0?'pass':'fail','Image Loading',brokenImages.length===0?'All images loaded':brokenImages.length+' broken image(s)',brokenImages.length>0?'Fix broken image sources':'');let scripts=qa('script[src]');let scriptCount=scripts.length;addTest('technical',scriptCount<30?'pass':'warn','External Scripts',scriptCount+' external script(s)',scriptCount>=30?'Consider script consolidation':'');let styleSheets=d.styleSheets.length;addTest('technical',styleSheets<20?'pass':'warn','Stylesheets',styleSheets+' stylesheet(s)',styleSheets>=20?'Consider CSS consolidation':'');let isDev=window.location.hostname.includes('local')||window.location.hostname.includes('dev')||window.location.hostname.includes('test')||window.location.hostname.includes('stage');addTest('technical',!isDev?'pass':'warn','Environment Detection',isDev?'Non-production environment':'Production environment',isDev?'Verify this is correct environment':'');let tableauAPI=typeof tableau!=='undefined'||d.querySelector('[src*=\"tableau\"]');addTest('technical',tableauAPI?'pass':'fail','Tableau API',tableauAPI?'Tableau detected':'Tableau not detected',!tableauAPI?'Verify Tableau is properly loaded':'')},testAccessibility=async()=>{let images=qa('img');let imagesNoAlt=Array.from(images).filter(img=>!img.alt||img.alt.trim()==='');addTest('accessibility',imagesNoAlt.length===0?'pass':'fail','Image Alt Text',imagesNoAlt.length+'/'+images.length+' images missing alt',imagesNoAlt.length>0?'Add alt text to all images':'');let buttons=qa('button,[role=\"button\"]');let buttonsNoLabel=Array.from(buttons).filter(btn=>!btn.textContent.trim()&&!btn.getAttribute('aria-label')&&!btn.getAttribute('title'));addTest('accessibility',buttonsNoLabel.length===0?'pass':'warn','Button Labels',buttonsNoLabel.length+'/'+buttons.length+' buttons without labels',buttonsNoLabel.length>0?'Add aria-label or title to buttons':'');let focusable=qa('a,button,input,select,textarea,[tabindex]');addTest('accessibility',focusable.length>0?'pass':'warn','Keyboard Navigation',focusable.length+' focusable element(s)',focusable.length===0?'Ensure keyboard navigation support':'');let landmarks=qa('[role=\"main\"],[role=\"navigation\"],[role=\"banner\"],main,nav,header');addTest('accessibility',landmarks.length>0?'pass':'warn','ARIA Landmarks',landmarks.length+' landmark(s) found',landmarks.length===0?'Add semantic HTML/ARIA landmarks':'');let h1Count=qa('h1').length;addTest('accessibility',h1Count===1?'pass':'warn','Heading Structure',h1Count+' H1 heading(s)',h1Count!==1?'Ensure single H1 per page':'');let contrastIssues=[];qa('*').forEach(el=>{let style=window.getComputedStyle(el);let bg=style.backgroundColor,fg=style.color;if(fg&&bg&&bg!=='rgba(0, 0, 0, 0)'){let contrast=getContrastRatio(fg,bg);if(contrast<4.5&&el.textContent.trim())contrastIssues.push(el)}});addTest('accessibility',contrastIssues.length<10?'pass':'warn','Color Contrast','~'+contrastIssues.length+' potential contrast issues',contrastIssues.length>=10?'Review color contrast ratios (WCAG 4.5:1)':'')},testSecurity=async()=>{let sensitiveTerms=['ssn','password','credit card','api key','secret'];let foundSensitive=sensitiveTerms.filter(term=>d.body.textContent.toLowerCase().includes(term));addTest('security',foundSensitive.length===0?'pass':'warn','Sensitive Data Exposure',foundSensitive.length===0?'No obvious sensitive terms':'Found: '+foundSensitive.join(', '),foundSensitive.length>0?'Verify sensitive data is protected':'');let httpsUrls=Array.from(qa('[src],[href]')).map(el=>el.src||el.href).filter(url=>url.startsWith('http://'));addTest('security',httpsUrls.length===0?'pass':'warn','HTTPS Usage',httpsUrls.length+' non-HTTPS URLs',httpsUrls.length>0?'Use HTTPS for all resources':'');let externalLinks=Array.from(qa('a[href]')).filter(a=>a.hostname&&a.hostname!==window.location.hostname);addTest('security',externalLinks.length<20?'pass':'info','External Links',externalLinks.length+' external link(s)');let iframes=qa('iframe');let sandboxedIframes=Array.from(iframes).filter(f=>f.hasAttribute('sandbox'));addTest('security',sandboxedIframes.length===iframes.length?'pass':'warn','Iframe Security',sandboxedIframes.length+'/'+iframes.length+' iframes sandboxed',sandboxedIframes.length<iframes.length?'Consider sandboxing iframes':'')},getContrastRatio=(fg,bg)=>{let getLuminance=color=>{let rgb=color.match(/\\d+/g);if(!rgb||rgb.length<3)return 0;let[r,g,b]=rgb.map(v=>v/255).map(v=>v<=0.03928?v/12.92:Math.pow((v+0.055)/1.055,2.4));return 0.2126*r+0.7152*g+0.0722*b};let l1=getLuminance(fg),l2=getLuminance(bg),lighter=Math.max(l1,l2),darker=Math.min(l1,l2);return(lighter+0.05)/(darker+0.05)},runAllTests=async()=>{testSuite.results=[];testSuite.passed=testSuite.failed=testSuite.warnings=testSuite.info=0;testSuite.startTime=Date.now();updateProgress(5);await testDeploymentIntegrity();updateProgress(15);await testVersionControl();updateProgress(25);await testVisualDesign();updateProgress(40);await testDataValidation();updateProgress(55);await testFunctionalTests();updateProgress(70);await testPerformance();updateProgress(85);await testAccessibility();updateProgress(95);await testSecurity();updateProgress(100);renderResults()},renderResults=()=>{let categories={deployment:[],version:[],visual:[],data:[],functional:[],technical:[],accessibility:[],security:[]};testSuite.results.forEach(r=>{if(categories[r.category])categories[r.category].push(r)});let summaryHtml='<div style=\"display:grid;grid-template-columns:repeat(4,1fr);gap:10px;margin-bottom:16px\"><div style=\"background:#0f172a;padding:14px;border-radius:10px;text-align:center;border:1px solid #334155\"><div style=\"font-size:28px;font-weight:700;margin-bottom:4px;color:#10b981\">'+testSuite.passed+'</div><div style=\"font-size:10px;color:#94a3b8;text-transform:uppercase;letter-spacing:.5px;font-weight:600\">Passed</div></div><div style=\"background:#0f172a;padding:14px;border-radius:10px;text-align:center;border:1px solid #334155\"><div style=\"font-size:28px;font-weight:700;margin-bottom:4px;color:#ef4444\">'+testSuite.failed+'</div><div style=\"font-size:10px;color:#94a3b8;text-transform:uppercase;letter-spacing:.5px;font-weight:600\">Failed</div></div><div style=\"background:#0f172a;padding:14px;border-radius:10px;text-align:center;border:1px solid #334155\"><div style=\"font-size:28px;font-weight:700;margin-bottom:4px;color:#f59e0b\">'+testSuite.warnings+'</div><div style=\"font-size:10px;color:#94a3b8;text-transform:uppercase;letter-spacing:.5px;font-weight:600\">Warnings</div></div><div style=\"background:#0f172a;padding:14px;border-radius:10px;text-align:center;border:1px solid #334155\"><div style=\"font-size:28px;font-weight:700;margin-bottom:4px;color:#3b82f6\">'+testSuite.info+'</div><div style=\"font-size:10px;color:#94a3b8;text-transform:uppercase;letter-spacing:.5px;font-weight:600\">Info</div></div></div>';summaryHtml+='<div style=\"display:flex;justify-content:space-between;padding:8px;background:#0f172a;border-radius:6px;margin:4px 0;font-size:12px\"><span style=\"color:#94a3b8\">Total Tests</span><span style=\"color:#f1f5f9;font-weight:600\">'+(testSuite.passed+testSuite.failed+testSuite.warnings+testSuite.info)+'</span></div>';summaryHtml+='<div style=\"display:flex;justify-content:space-between;padding:8px;background:#0f172a;border-radius:6px;margin:4px 0;font-size:12px\"><span style=\"color:#94a3b8\">Execution Time</span><span style=\"color:#f1f5f9;font-weight:600\">'+((Date.now()-testSuite.startTime)/1000).toFixed(2)+'s</span></div>';summaryHtml+='<div style=\"display:flex;justify-content:space-between;padding:8px;background:#0f172a;border-radius:6px;margin:4px 0;font-size:12px\"><span style=\"color:#94a3b8\">Success Rate</span><span style=\"color:#f1f5f9;font-weight:600\">'+Math.round(testSuite.passed/(testSuite.passed+testSuite.failed+testSuite.warnings)*100)+'%</span></div>';summaryHtml+='<div style=\"margin-top:12px;margin-bottom:8px;font-weight:bold;padding:8px 12px;background:#0f172a;border-radius:8px;border-left:4px solid #3b82f6;color:#cbd5e1;font-size:13px\">Critical Issues</div>';if(testSuite.failed===0){summaryHtml+='<div style=\"display:flex;gap:10px;padding:10px 12px;margin:6px 0;border-radius:8px;font-size:13px;line-height:1.5;border-left:4px solid;background:#064e3b;border-color:#10b981;color:#d1fae5\"><span style=\"font-size:16px;margin-top:1px\">✓</span><div><div style=\"font-weight:600;display:block;margin-bottom:3px\">No Critical Issues</div><div style=\"font-size:11px;opacity:.85;line-height:1.4\">All critical tests passed</div></div></div>'}else{summaryHtml+=testSuite.results.filter(r=>r.status==='fail').map(r=>'<div style=\"display:flex;gap:10px;padding:10px 12px;margin:6px 0;border-radius:8px;font-size:13px;line-height:1.5;border-left:4px solid;background:#7f1d1d;border-color:#ef4444;color:#fecaca\"><span style=\"font-size:16px;margin-top:1px\">✗</span><div><div style=\"font-weight:600;display:block;margin-bottom:3px\">'+r.label+'</div><div style=\"font-size:11px;opacity:.85;line-height:1.4\">'+r.details+(r.recommendation?' - '+r.recommendation:'')+'</div></div></div>').join('')}qs('#tab-summary').innerHTML=summaryHtml;let renderCategory=(cat,title)=>{let tests=categories[cat];if(!tests||tests.length===0)return'';let html='<div style=\"margin-bottom:16px\"><div style=\"margin-bottom:8px;font-weight:bold;padding:8px 12px;background:#0f172a;border-radius:8px;border-left:4px solid #3b82f6;color:#cbd5e1;font-size:13px\">'+title+'<span style=\"display:inline-block;background:#334155;color:#f1f5f9;padding:3px 8px;border-radius:12px;font-size:10px;font-weight:700;margin-left:6px\">'+tests.length+'</span></div>';html+=tests.map(t=>{let icon=t.status==='pass'?'✓':t.status==='fail'?'✗':t.status==='warn'?'⚠':'ℹ';let bgColor=t.status==='pass'?'#064e3b':t.status==='fail'?'#7f1d1d':t.status==='warn'?'#78350f':'#1e3a8a';let borderColor=t.status==='pass'?'#10b981':t.status==='fail'?'#ef4444':t.status==='warn'?'#f59e0b':'#3b82f6';let textColor=t.status==='pass'?'#d1fae5':t.status==='fail'?'#fecaca':t.status==='warn'?'#fed7aa':'#bfdbfe';return'<div style=\"display:flex;gap:10px;padding:10px 12px;margin:6px 0;border-radius:8px;font-size:13px;line-height:1.5;border-left:4px solid;background:'+bgColor+';border-color:'+borderColor+';color:'+textColor+'\"><span style=\"font-size:16px;margin-top:1px\">'+icon+'</span><div><div style=\"font-weight:600;display:block;margin-bottom:3px\">'+t.label+'</div><div style=\"font-size:11px;opacity:.85;line-height:1.4\">'+t.details+(t.recommendation?' <strong>→</strong> '+t.recommendation:'')+'</div></div></div>'}).join('')+'</div>';return html};qs('#tab-visual').innerHTML=renderCategory('visual','Visual Design & Branding');qs('#tab-data').innerHTML=renderCategory('data','Data Quality & Validation')+renderCategory('deployment','Deployment Integrity')+renderCategory('version','Version Control');qs('#tab-functional').innerHTML=renderCategory('functional','Functionality & Interactivity');qs('#tab-technical').innerHTML=renderCategory('technical','Performance & Technical')+renderCategory('accessibility','Accessibility')+renderCategory('security','Security & Privacy')},testSuite={results:[],passed:0,failed:0,warnings:0,info:0,startTime:Date.now()},m=()=>{qs('#ttsPanel')?.remove();let p=ce('div');p.id='ttsPanel';p.innerHTML='<style>#ttsPanel{position:fixed;top:20px;right:20px;z-index:999999;background:#fff;border-radius:6px;box-shadow:0 2px 8px rgba(0,0,0,.15);font-family:system-ui,Arial,sans-serif;width:400px;max-height:500px;display:flex;flex-direction:column;background:#0f172a;color:#f1f5f9;border:1px solid #334155}#ttsPanel .hdr{display:flex;padding:10px;border-bottom:1px solid #334155;background:#1e293b;border-radius:6px 6px 0 0;cursor:move;user-select:none}#ttsPanel h3{margin:0;font-size:13px;flex:1;font-weight:700}#ttsPanel .cls{background:rgba(255,255,255,0.1);border:0;font-size:18px;cursor:pointer;color:#fff;padding:0;line-height:1;width:auto;height:auto;border-radius:8px;width:32px;height:32px;display:flex;align-items:center;justify-content:center;transition:all .2s;position:absolute;right:6px;top:4px}#ttsPanel .cls:hover{background:rgba(255,255,255,0.2)}#ttsPanel .btns{display:flex;gap:6px;padding:10px;border-bottom:1px solid #334155;flex-wrap:wrap}#ttsPanel button{flex:1;min-width:80px;padding:6px;border:1px solid #334155;border-radius:3px;background:#334155;cursor:pointer;font-size:11px;color:#f1f5f9}#ttsPanel button:hover{background:#475569}#ttsPanel #ttsOutput{flex:1;overflow-y:auto;padding:10px;font-size:11px;line-height:1.5;max-height:350px}#tts-nav{display:flex;background:#1e293b;border-bottom:1px solid #334155}#tts-nav button{flex:1;padding:12px 8px;background:none;border:none;color:#94a3b8;cursor:pointer;font-size:12px;font-weight:600;border-bottom:3px solid transparent;transition:all .2s}#tts-nav button:hover{color:#f1f5f9;background:#334155}#tts-nav button.active{color:#3b82f6;border-bottom-color:#3b82f6;background:#0f172a}#tts-progress{height:3px;background:#1e293b}#tts-progress-bar{height:100%;background:linear-gradient(90deg,#10b981,#3b82f6);width:0;transition:width .3s}.tts-tab-content{display:none}.tts-tab-content.active{display:block}</style><div id=\"tts-progress\"><div id=\"tts-progress-bar\"></div></div><div class=\"hdr\"><h3>Tableau Test Suite</h3><button class=\"cls\" style=\"position:absolute;right:6px;top:4px\">&times;</button></div><div id=\"tts-nav\"><button class=\"active\" data-tab=\"summary\">Summary</button><button data-tab=\"visual\">Visual</button><button data-tab=\"data\">Data</button><button data-tab=\"functional\">Functional</button><button data-tab=\"technical\">Technical</button></div><div id=\"ttsOutput\"><div id=\"tab-summary\" class=\"tts-tab-content active\"></div><div id=\"tab-visual\" class=\"tts-tab-content\"></div><div id=\"tab-data\" class=\"tts-tab-content\"></div><div id=\"tab-functional\" class=\"tts-tab-content\"></div><div id=\"tab-technical\" class=\"tts-tab-content\"></div></div><div class=\"btns\"><button id=\"btnRun\">▶ Run Tests</button><button id=\"btnExport\">⤓ Export</button></div>';d.body.appendChild(p);let dr=!1,ox=0,oy=0,h=qs('.hdr'),md='mousedown',mm='mousemove',mu='mouseup';h.addEventListener(md,e=>{dr=!0;let r=p.getBoundingClientRect();ox=e.clientX-r.left;oy=e.clientY-r.top});d.addEventListener(mm,e=>dr&&(p.style.left=(e.clientX-ox)+'px',p.style.top=(e.clientY-oy)+'px'));d.addEventListener(mu,()=>dr=!1);qs('.cls').addEventListener('click',()=>qs('#ttsPanel')?.remove());qs('#btnRun').addEventListener('click',function(){this.disabled=!0;this.textContent='...';runAllTests().then(()=>{this.textContent='▶ Run Tests';this.disabled=!1})});qs('#btnExport').addEventListener('click',()=>{let report={metadata:{timestamp:new Date().toISOString(),url:window.location.href,userAgent:navigator.userAgent,executionTime:Date.now()-testSuite.startTime},summary:{total:testSuite.passed+testSuite.failed+testSuite.warnings+testSuite.info,passed:testSuite.passed,failed:testSuite.failed,warnings:testSuite.warnings,info:testSuite.info,successRate:Math.round(testSuite.passed/(testSuite.passed+testSuite.failed+testSuite.warnings)*100)},results:testSuite.results,recommendations:testSuite.results.filter(r=>r.recommendation).map(r=>({test:r.label,recommendation:r.recommendation}))};let blob=new Blob([js(report,null,2)],{type:'application/json'});let url=URL.createObjectURL(blob);let a=ce('a');a.href=url;a.download='tableau-test-report-'+Date.now()+'.json';d.body.appendChild(a);a.click();d.body.removeChild(a);URL.revokeObjectURL(url)});qa('#tts-nav button').forEach(btn=>{btn.addEventListener('click',()=>{qa('#tts-nav button').forEach(b=>b.classList.remove('active'));btn.classList.add('active');qa('.tts-tab-content').forEach(c=>c.classList.remove('active'));qs('#tab-'+btn.dataset.tab).classList.add('active')})});runAllTests()};m()})();